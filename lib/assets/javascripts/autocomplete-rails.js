$(document).ready(function(){$('input[data-autocomplete]').railsAutocomplete()});(function(jQuery){var self=null;jQuery.fn.railsAutocomplete=function(){return this.live('focus',function(){if(!this.railsAutoCompleter){this.railsAutoCompleter=new jQuery.railsAutocomplete(this)}})};jQuery.railsAutocomplete=function(e){_e=e;this.init(_e)};jQuery.railsAutocomplete.fn=jQuery.railsAutocomplete.prototype={railsAutocomplete:'0.0.1'};jQuery.railsAutocomplete.fn.extend=jQuery.railsAutocomplete.extend=jQuery.extend;jQuery.railsAutocomplete.fn.extend({init:function(e){e.delimiter=$(e).attr('data-delimiter')||null;var cache={},lastXhr,maxLimitTerms=[];function split(val){return val.split(e.delimiter)}function extractLast(term){return split(term).pop().replace(/^\s+/,"")}$(e).autocomplete({source:function(request,response){var term=request.term;if(term in cache){response(cache[term]);return}for(x in maxLimitTerms){v=maxLimitTerms[x];if(term.indexOf(v)==0){var c=cache[v];var data=[];$.each(c,function(i,o){var value=o.value.toLowerCase();if(value.indexOf(term)!=-1){data.push(o)}});cache[term]=data;response(data);return}}$.getJSON($(e).attr('data-autocomplete'),{term:extractLast(request.term)},function(data,status,xhr){cache[term]=data;if(data.length<10){maxLimitTerms.push(term)}if(xhr===lastXhr){$(data).each(function(i,el){var obj={};obj[el.id]=el;$(e).data(obj)});response.apply(null,arguments)}})},search:function(){var term=extractLast(this.value)},focus:function(){},select:function(event,ui){var terms=split(this.value);terms.pop();terms.push(ui.item.value);if(e.delimiter!=null){terms.push("");this.value=terms.join(e.delimiter)}else{this.value=terms.join("");if($(this).attr('data-id-element')){$($(this).attr('data-id-element')).val(ui.item.id)}if($(this).attr('data-update-elements')){var data=$(this).data(ui.item.id.toString());var update_elements=$.parseJSON($(this).attr("data-update-elements"));for(var key in update_elements){$(update_elements[key]).val(data[key])}}}var remember_string=this.value;$(this).bind('keyup.clearId',function(){if($(this).val().trim()!=remember_string.trim()){$($(this).attr('data-id-element')).val("");$(this).unbind('keyup.clearId')}});$(this).trigger('railsAutocomplete.select',ui);return false}})}})})(jQuery);

